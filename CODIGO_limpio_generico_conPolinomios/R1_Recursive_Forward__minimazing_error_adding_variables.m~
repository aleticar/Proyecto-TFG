clear all
close all
clc
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%% Adding variables - Recursive Forward minimizing error %%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 load X
 X=dataX;
    %%%%%%%%%%%% %%%%%% 
       %%%%%%%%%%%% %%%%%%  
  X=X-mean(X); %%%% creo IMPORTANTE  
  %%%%%% %%%%%% %%%%%% %%%%%% 
  %%%%%% %%%%%% %%%%%% %%%%%% 
%%%%%%%%%%%%%%%
  load Y 
  Y=dataY;
   %%%%%%%%%%%% %%%%%%  
  Y=Y-mean(Y); %%%% IMPORTANTE  O CAMBIAR V(0)
  %%%%%% %%%%%% %%%%%% %%%%%% 
 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
 chosen_output=1; %%%  1 or 2 %%% OUTPUT
 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
    [dim1,dim2]=size(X);
   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
   %%%%%%%%%%%% %%%%%%%%%%%%   %%%%%%%%%%%% %%%%%%%%%%%%   %%%%%%%%%%%% %%%%%%%%%%%% 
   pos_before=[];
   todo_all_possible=1:dim2; %%% all possible positions of variables
  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
   for i=1:dim2
      %%%%%%%%%%%%%%%%%%%%%%%%%%% 
       if mod(i,10)==0
         disp([num2str(i/dim2*100),'%'])
       end
       %%%%%%%%%%%%%%%%%%%%%%%%%%%  
     for j=1:length(todo_all_possible)
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%       
         pos=[pos_before todo_all_possible(j)];
         Xnow=X(:,pos); 
         %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
         orden_poli=19;
         wa
         f=model(Xnow,Y(:,chosen_output),orden_poli);
         %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
         alpha=2;
         error_par_aux(j)=mean(abs(Y(:,chosen_output)-f).^alpha);
     end
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
    error_par(i)=min(error_par_aux);
   %%% pos_err_min=find(error_par(i)==error_par_aux);
     pos_err_min=find(error_par_aux==error_par(i));
     pos_err_min=pos_err_min(1); %%%% just for security
    pos_before=[pos_before todo_all_possible(pos_err_min)];
    todo_all_possible(pos_err_min)=[];
    clear  error_par_aux
   end
  %%%%%%%%%%%%%%%%% %%%%%%%%%%%%%%%%% %%%%%%%%%%%%%%%%% %%%%%%%%%%%%%%%%% 
  %%%%%%%%%%%%%%%%% %%%%%%%%%%%%%%%%% %%%%%%%%%%%%%%%%% %%%%%%%%%%%%%%%%% 
  %%%%%%%%%%%%%%%%% %%%%%%%%%%%%%%%%% %%%%%%%%%%%%%%%%% %%%%%%%%%%%%%%%%% 
  disp('------------------------------------')

  disp(['Solution / RANKING: (orden poli = ',num2str(orden_poli),')']) 
      SOL=pos_before
  
  %%%%%%%%%%%%%%%%% %%%%%%%%%%%%%%%%% %%%%%%%%%%%%%%%%% %%%%%%%%%%%%%%%%% 
  %%%%%%%%%%%%%%%%% %%%%%%%%%%%%%%%%% %%%%%%%%%%%%%%%%% %%%%%%%%%%%%%%%%% 
  %%%%%%%%%%%%%%%%% %%%%%%%%%%%%%%%%% %%%%%%%%%%%%%%%%% %%%%%%%%%%%%%%%%% 
   figure
 %  error_par(1)=[];
 V=[mean(abs(Y(:,chosen_output)).^alpha) error_par];
  plot(0:dim2,V,'o-')
  %%%%%%%%%%%%%%%%%
   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
   disp('------------------------------------------------')
   disp(['Recall chosen_output = ',num2str(chosen_output),' and alpha = ',num2str(alpha)])
   disp('------------------------------------------------')
   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  %%%%%%%%%%%%%%%%%
  %%%%%%%%%%%%%%%%%
  %%%% STUDY FIRST DERIVATIVE AND CONVEXITY DO NOT STRICTLY REQUIRED
  %figure
  %stem(V(1:end-1)-V(2:end))
  d1=V(1:end-1)-V(2:end);
  posder1=find(d1<0);
  length(posder1)
  d2=d1(1:end-1)-d1(2:end);
  posder2=find(d2<0);
  length(posder2)
   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
 %%%%%% output 1  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
 %a=0.1%113    56    14     8     4     1   114    45   122   119   103     5    54    88    40    63    64
 %a=0.5%113    39    14     8     4    56     1   114    18    13    37     3    36   102    47    43   110
 %a=1  %113    14     8     4    56   115   114    16    43    75    55    13    37   122     2   107    11
 %a=2  %113    39    14     8     4    56   115   114    16    13    37    77    43   107    55     3    11
 %a=3  %113    14     8     4   115   114    56    18    43     2   107    13    11   122   118    27    51
 %a=4  %114    88    46    13    11     6    14    16   115   113    56    38    77   119   101     3    43
 %a=5  %114    88    46    13    11     6    14    16    50   113   115    38    56   101    92     8     3
 %a=6  % 15    20    10   114    88    11    13     8    14    16    77    80    56    51   115   113    38
 
 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
 %%%%%% output 2  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
 %a=0.1%114    88   115     3    52   109    33   113    40     5    51    34    36   106    96    17    85
 %a=0.5%114    88   115     3    42     5   113   109    33    54    38    65    36    79    80   101    40
 %a=1  %114    88   115     3    42     5   113   109    64    31    59    15     9   121    13    36    79
 %a=1.5%114    88   115     3    42     5   113   109    65    31    25    37     4   122     2    50    40
 %a=2  %114    88   115     3   113   109     5    25    65    40    33    37     4   122    68   107    36
 %a=2.5%114    88     1   113     3   109     5    40    65    39    33    25   122     4    37    50     2
 %a=3  %114    88     1   113     3    40     5   109    65    39   122    25    33    37     4    50    68
 %a=4  %114    88    49     1   113     3    40     5   122    37    57   109    47    33    44   111   101
 %a=5  %114    88    49     1   113     3    47    44    15    75   122     5    40    39   105    57    37
 %a=6  %114    23   113     1   105     7    86    40    39     3    57    37    56    36     5    45    47
 %a=10 % 15    41    25     6    70    93    95    42   121    84    53    59    40    80    64    71    35
